<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Academic Calendar</h1>
    {{#if (eq user.role 'admin')}}
    <div style="display: flex; gap: 1rem;">
        <a href="/calendar/yearly" class="btn btn-outline-primary">
            <i class="fas fa-calendar-alt"></i> Yearly View
        </a>
        <a href="/calendar/create" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Calendar Event
        </a>
    </div>
    {{/if}}
</div>

<div class="card">
    <div id="calendar"></div>
</div>

{{#if events.length}}
<div style="margin-top: 2rem;">
    <h2>Upcoming Events</h2>
    <div class="row">
        {{#each events}}
        <div class="card event-card">
            <h3>{{title}}</h3>
            <p>{{description}}</p>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                <div>
                    <strong>Date:</strong> {{formatDate date}}<br>
                    <strong>Type:</strong> {{type}}
                </div>
                {{#if (eq ../user.role 'admin')}}
                <div>
                    <a href="/calendar/edit/{{_id}}" class="btn btn-secondary btn-sm">Edit</a>
                    <form action="/calendar/delete/{{_id}}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete</button>
                    </form>
                </div>
                {{/if}}
            </div>
        </div>
        {{/each}}
    </div>
</div>
{{/if}}

<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: '/calendar/api/events',
        eventClick: function(info) {
            alert('Event: ' + info.event.title + '\nDate: ' + info.event.start.toLocaleDateString());
        }
    });
    calendar.render();
});
</script>
