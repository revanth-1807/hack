<section style="padding: 2rem 0;">
    <h1 style="margin-bottom: 2rem;">Welcome, {{user.name}}!</h1>
    
    {{#if (eq user.role 'admin')}}
    <!-- Admin Quick Actions -->
    <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <h2 style="margin-bottom: 1rem;">
            <i class="fas fa-crown"></i> Admin Panel
        </h2>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="/admin/cafe" class="btn btn-light">
                <i class="fas fa-utensils"></i> Cafeteria Admin
            </a>
            <a href="/admin/navigation/buildings" class="btn btn-light">
                <i class="fas fa-map"></i> Navigation Admin
            </a>
            <a href="/events/create" class="btn btn-light">
                <i class="fas fa-calendar-plus"></i> Create Event
            </a>
        </div>
    </div>
    {{/if}}

    <!-- Quick Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-number">12</div>
            <div class="stat-label">Upcoming Events</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">3</div>
            <div class="stat-label">Active Orders</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">2</div>
            <div class="stat-label">Reported Items</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">15</div>
            <div class="stat-label">Campus Notifications</div>
        </div>
    </div>

    <div class="row">
        <!-- Upcoming Events -->
        <div style="grid-column: span 2;">
            <div class="card">
                <h2 style="margin-bottom: 1rem;">
                    <i class="fas fa-calendar-alt"></i> Upcoming Events
                </h2>
                <div id="upcoming-events">
                    <p>Loading upcoming events...</p>
                </div>
                <a href="/events" class="btn btn-primary" style="margin-top: 1rem;">
                    View All Events
                </a>
            </div>
        </div>

        <!-- Quick Actions -->
        <div>
            <div class="card">
                <h2 style="margin-bottom: 1rem;">
                    <i class="fas fa-bolt"></i> Quick Actions
                </h2>
                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <a href="/events" class="btn btn-secondary">
                        <i class="fas fa-calendar-plus"></i> Register for Events
                    </a>
                    <a href="/cafeteria" class="btn btn-secondary">
                        <i class="fas fa-utensils"></i> Order Food
                    </a>
                    <a href="/lostfound/report" class="btn btn-secondary">
                        <i class="fas fa-search"></i> Report Lost Item
                    </a>
                    <a href="/navigation/map" class="btn btn-secondary">
                        <i class="fas fa-map"></i> Campus Map
                    </a>
                </div>
            </div>

            <!-- Cafeteria Status -->
            <div class="card" style="margin-top: 1rem;">
                <h2 style="margin-bottom: 1rem;">
                    <i class="fas fa-utensils"></i> Cafeteria Status
                </h2>
                <div id="queue-status">
                    <p>Loading queue status...</p>
                </div>
                <a href="/cafeteria" class="btn btn-primary" style="margin-top: 1rem;">
                    Visit Cafeteria
                </a>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="card" style="margin-top: 2rem;">
        <h2 style="margin-bottom: 1rem;">
            <i class="fas fa-history"></i> Recent Activity
        </h2>
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Activity</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Registered for Tech Workshop</td>
                        <td>2024-01-15</td>
                        <td><span class="badge badge-success">Confirmed</span></td>
                    </tr>
                    <tr>
                        <td>Food Order #ORD-12345</td>
                        <td>2024-01-14</td>
                        <td><span class="badge badge-warning">Preparing</span></td>
                    </tr>
                    <tr>
                        <td>Reported lost backpack</td>
                        <td>2024-01-13</td>
                        <td><span class="badge badge-info">Pending</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Campus Announcements -->
    <div class="card" style="margin-top: 2rem;">
        <h2 style="margin-bottom: 1rem;">
            <i class="fas fa-bullhorn"></i> Campus Announcements
        </h2>
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <div style="padding: 1rem; background: #e3f2fd; border-radius: 5px;">
                <h4 style="margin-bottom: 0.5rem;">Library Renovation</h4>
                <p style="margin: 0; color: #666;">Main library will be closed for renovation from Jan 20-25. Alternative study spaces available.</p>
                <small style="color: #999;">Posted: 2024-01-10</small>
            </div>
            <div style="padding: 1rem; background: #fff3cd; border-radius: 5px;">
                <h4 style="margin-bottom: 0.5rem;">Weather Advisory</h4>
                <p style="margin: 0; color: #666;">Heavy rain expected tomorrow. Please carry umbrellas and plan accordingly.</p>
                <small style="color: #999;">Posted: 2024-01-14</small>
            </div>
        </div>
    </div>
</section>

<script>
// Load dynamic content when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Load upcoming events
    fetch('/api/calendar/upcoming')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.data.length > 0) {
                const eventsHtml = data.data.map(event => `
                    <div class="card event-card" style="margin-bottom: 0.5rem;">
                        <h4>${event.title}</h4>
                        <p>${new Date(event.startDate).toLocaleDateString()} - ${event.type}</p>
                    </div>
                `).join('');
                document.getElementById('upcoming-events').innerHTML = eventsHtml;
            } else {
                document.getElementById('upcoming-events').innerHTML = '<p>No upcoming events</p>';
            }
        })
        .catch(error => {
            console.error('Error loading events:', error);
            document.getElementById('upcoming-events').innerHTML = '<p>Error loading events</p>';
        });

    // Load queue status
    fetch('/cafeteria/queue/status')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const queue = data.data;
                const statusClass = `queue-${queue.crowdColor}`;
                document.getElementById('queue-status').innerHTML = `
                    <div class="queue-status ${statusClass}">
                        <h3>${queue.crowdStatus}</h3>
                        <p>${queue.message}</p>
                        <p>Current: ${queue.currentCount} / ${queue.maxCapacity}</p>
                        <p>Estimated wait: ${queue.estimatedWaitTime} minutes</p>
                    </div>
                `;
            }
        })
        .catch(error => {
            console.error('Error loading queue status:', error);
            document.getElementById('queue-status').innerHTML = '<p>Error loading queue status</p>';
        });
});
</script>
