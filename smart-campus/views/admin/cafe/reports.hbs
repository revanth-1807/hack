<div style="display: flex; justify-content: between; align-items: center; margin-bottom: 2rem;">
    <h1>Reports & Analytics</h1>
    <div>
        <a href="/admin/cafe" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> Print Report
        </button>
    </div>
</div>

<!-- Date Range Filter -->
<div class="card" style="margin-bottom: 2rem;">
    <h3>Filter Reports</h3>
    <form action="/admin/cafe/reports" method="GET">
        <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: end;">
            <div class="form-group">
                <label class="form-label">Start Date</label>
                <input type="date" name="startDate" class="form-control" value="{{startDate}}">
            </div>
            <div class="form-group">
                <label class="form-label">End Date</label>
                <input type="date" name="endDate" class="form-control" value="{{endDate}}">
            </div>
            <div>
                <button type="submit" class="btn btn-primary">Apply Filter</button>
                <a href="/admin/cafe/reports" class="btn btn-secondary">Reset</a>
            </div>
        </div>
    </form>
</div>

<!-- Summary Statistics -->
<div class="card" style="margin-bottom: 2rem;">
    <h3>Summary Overview</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="text-align: center; padding: 1.5rem; background: #e7f3ff; border-radius: 8px;">
            <i class="fas fa-receipt" style="font-size: 2.5rem; color: #007bff;"></i>
            <h4>Total Orders</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: #007bff;">{{stats.totalOrders}}</div>
            <p style="color: #666; margin: 0.5rem 0 0 0;">{{stats.ordersChange}} from previous period</p>
        </div>
        <div style="text-align: center; padding: 1.5rem; background: #e7f8e7; border-radius: 8px;">
            <i class="fas fa-rupee-sign" style="font-size: 2.5rem; color: #28a745;"></i>
            <h4>Total Revenue</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: #28a745;">₹{{stats.totalRevenue}}</div>
            <p style="color: #666; margin: 0.5rem 0 0 0;">{{stats.revenueChange}} from previous period</p>
        </div>
        <div style="text-align: center; padding: 1.5rem; background: #fff3cd; border-radius: 8px;">
            <i class="fas fa-users" style="font-size: 2.5rem; color: #fd7e14;"></i>
            <h4>Average Order Value</h4>
            <div style="font-size: 2.5rem; font-weight: bold; color: #fd7e14;">₹{{stats.avgOrderValue}}</div>
            <p style="color: #666; margin: 0.5rem 0 0 0;">Per customer order</p>
        </div>
        <div style="text-align: center; padding: 1.5rem; background: #f8d7da; border-radius: 8px;">
            <i class="fas fa-utensils" style="font-size: 2.5rem; color: #dc3545;"></i>
            <h4>Popular Item</h4>
            <div style="font-size: 1.5rem; font-weight: bold; color: #dc3545;">{{stats.popularItem.name}}</div>
            <p style="color: #666; margin: 0.5rem 0 0 0;">{{stats.popularItem.count}} orders</p>
        </div>
    </div>
</div>

<!-- Revenue Chart (Placeholder) -->
<div class="card" style="margin-bottom: 2rem;">
    <h3>Revenue Trend</h3>
    <div style="height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
        <div style="text-align: center;">
            <i class="fas fa-chart-line" style="font-size: 4rem; color: #6c757d;"></i>
            <p>Revenue chart would be displayed here</p>
            <small style="color: #999;">(Integration with chart library required)</small>
        </div>
    </div>
</div>

<!-- Top Selling Items -->
<div class="card" style="margin-bottom: 2rem;">
    <h3>Top Selling Menu Items</h3>
    {{#if topItems.length}}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Rank</th>
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Item Name</th>
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Category</th>
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Quantity Sold</th>
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Total Revenue</th>
                    <th style="padding: 1rem; text-align: left; border-bottom: 2px solid #dee2e6;">Popularity</th>
                </tr>
            </thead>
            <tbody>
                {{#each topItems}}
                <tr>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <span class="badge badge-primary">#{{add @index 1}}</span>
                    </td>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <strong>{{name}}</strong>
                    </td>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <span class="badge badge-secondary">{{category}}</span>
                    </td>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <strong>{{quantity}}</strong> units
                    </td>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <strong style="color: #28a745;">₹{{revenue}}</strong>
                    </td>
                    <td style="padding: 1rem; border-bottom: 1px solid #dee2e6;">
                        <div style="background: #e9ecef; height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: #007bff; height: 100%; width: {{popularity}}%; border-radius: 10px;"></div>
                        </div>
                        <small style="color: #666;">{{popularity}}% of total</small>
                    </td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
    {{else}}
    <div style="text-align: center; padding: 2rem;">
        <i class="fas fa-utensils" style="font-size: 3rem; color: #6c757d;"></i>
        <p>No sales data available for the selected period</p>
    </div>
    {{/if}}
</div>

<!-- Order Status Distribution -->
<div class="card" style="margin-bottom: 2rem;">
    <h3>Order Status Distribution</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        {{#each orderStatus}}
        <div style="text-align: center; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
            <div style="font-size: 2rem; font-weight: bold; 
                {{#if (eq status 'completed')}}color: #28a745;{{/if}}
                {{#if (eq status 'pending')}}color: #fd7e14;{{/if}}
                {{#if (eq status 'preparing')}}color: #17a2b8;{{/if}}
                {{#if (eq status 'ready')}}color: #6f42c1;{{/if}}
                {{#if (eq status 'cancelled')}}color: #dc3545;{{/if}}
            ">
                {{count}}
            </div>
            <div style="text-transform: capitalize; font-weight: 500;">{{status}}</div>
            <div style="color: #666; font-size: 0.9em;">{{percentage}}% of total</div>
        </div>
        {{/each}}
    </div>
</div>

<!-- Time-based Analysis -->
<div class="card">
    <h3>Peak Hours Analysis</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
        {{#each peakHours}}
        <div style="text-align: center; padding: 1rem; background: #e7f3ff; border-radius: 8px;">
            <div style="font-size: 1.5rem; font-weight: bold; color: #007bff;">{{orders}}</div>
            <div style="font-weight: 500;">{{hour}}</div>
            <div style="color: #666; font-size: 0.9em;">{{percentage}}% of daily orders</div>
        </div>
        {{/each}}
    </div>
</div>

<!-- Export Options -->
<div class="card" style="margin-top: 2rem;">
    <h3>Export Reports</h3>
    <div style="display: flex; gap: 1rem;">
        <a href="/admin/cafe/reports/export?type=csv&startDate={{startDate}}&endDate={{endDate}}" class="btn btn-outline-primary">
            <i class="fas fa-file-csv"></i> Export as CSV
        </a>
        <a href="/admin/cafe/reports/export?type=excel&startDate={{startDate}}&endDate={{endDate}}" class="btn btn-outline-success">
            <i class="fas fa-file-excel"></i> Export as Excel
        </a>
        <a href="/admin/cafe/reports/export?type=pdf&startDate={{startDate}}&endDate={{endDate}}" class="btn btn-outline-danger">
            <i class="fas fa-file-pdf"></i> Export as PDF
        </a>
    </div>
</div>

<style>
@media print {
    .btn {
        display: none !important;
    }
    
    .card {
        break-inside: avoid;
        margin-bottom: 1rem;
    }
}
</style>
